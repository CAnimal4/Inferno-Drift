<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Inferno Drift</title>
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <meta name="description" content="Inferno Drift — fast-paced arcade drifting game." />

  <style>
    html, body {
      margin: 0;
      padding: 0;
      background: #000;
      color: #fff;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      overflow: hidden;
    }

    canvas {
      display: block;
      margin: 0 auto;
      outline: none;
    }

    #loading-screen {
      position: fixed;
      inset: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      background: #000;
      z-index: 9999;
    }

    #loading-box {
      text-align: center;
    }

    #touch-joy {
      position: fixed;
      left: 16px;
      bottom: 16px;
      width: 140px;
      height: 140px;
      border-radius: 50%;
      background: rgba(255,255,255,0.05);
      touch-action: none;
      display: none;
      z-index: 50;
    }

    #joy-thumb {
      position: absolute;
      left: 50%;
      top: 50%;
      width: 44px;
      height: 44px;
      border-radius: 50%;
      transform: translate(-50%, -50%);
      background: rgba(255,255,255,0.25);
    }

    #hud {
      position: fixed;
      top: 12px;
      right: 12px;
      text-align: right;
      font-size: 14px;
    }
  </style>
</head>

<body>

<div id="loading-screen">
  <div id="loading-box">
    <div id="loading-text">Loading — 0%</div>
    <progress id="loading-bar" value="0" max="100"></progress>
  </div>
</div>

<canvas id="gameCanvas" tabindex="0"></canvas>

<div id="touch-joy">
  <div id="joy-thumb"></div>
</div>

<div id="hud">
  <div id="score">Score: 0</div>
</div>

<script>
/* ==========================
   Canvas + DPI handling
========================== */
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');

function resizeCanvas() {
  const cssW = window.innerWidth;
  const cssH = window.innerHeight;
  const dpr = Math.max(1, window.devicePixelRatio || 1);

  canvas.style.width = cssW + 'px';
  canvas.style.height = cssH + 'px';
  canvas.width = Math.floor(cssW * dpr);
  canvas.height = Math.floor(cssH * dpr);

  ctx.setTransform(dpr, 0, 0, dpr, 0, 0);
}

window.addEventListener('resize', resizeCanvas, { passive: true });
resizeCanvas();

/* ==========================
   Asset preloader (mock)
========================== */
const assets = {};
const assetList = [
  // Add real assets here if needed
];

function loadAssets(list) {
  const total = Math.max(1, list.length);
  let loaded = 0;

  return Promise.all(list.map(src => {
    return new Promise(res => {
      const img = new Image();
      img.onload = () => {
        loaded++;
        const pct = Math.round(loaded / total * 100);
        document.getElementById('loading-bar').value = pct;
        document.getElementById('loading-text').textContent = 'Loading — ' + pct + '%';
        assets[src] = img;
        res();
      };
      img.src = src;
    });
  }));
}

/* ==========================
   Input (keyboard + touch)
========================== */
const keys = {};
window.addEventListener('keydown', e => keys[e.key] = true);
window.addEventListener('keyup', e => keys[e.key] = false);

const joy = document.getElementById('touch-joy');
const thumb = document.getElementById('joy-thumb');
let joyVec = { x: 0, y: 0 };

function enableTouchControls() {
  joy.style.display = 'block';
}

function handleJoy(e, end=false) {
  e.preventDefault();
  if (end) {
    joyVec.x = joyVec.y = 0;
    thumb.style.transform = 'translate(-50%, -50%)';
    return;
  }
  const t = e.touches[0];
  const r = joy.getBoundingClientRect();
  const dx = (t.clientX - (r.left + r.width/2)) / (r.width/2);
  const dy = (t.clientY - (r.top + r.height/2)) / (r.height/2);
  const len = Math.hypot(dx, dy) || 1;
  joyVec.x = Math.max(-1, Math.min(1, dx / len));
  joyVec.y = Math.max(-1, Math.min(1, dy / len));
  thumb.style.left = (r.width/2 + joyVec.x * 40) + 'px';
  thumb.style.top  = (r.height/2 + joyVec.y * 40) + 'px';
}

joy.addEventListener('touchstart', handleJoy, { passive:false });
joy.addEventListener('touchmove', handleJoy, { passive:false });
joy.addEventListener('touchend', e => handleJoy(e, true), { passive:false });

if ('ontouchstart' in window) enableTouchControls();

/* ==========================
   Game state
========================== */
let score = 0;
const player = {
  x: 200,
  y: 200,
  vx: 0,
  vy: 0,
  speed: 400
};

/* ==========================
   Game loop (delta time)
========================== */
let last = performance.now();
let paused = false;

window.addEventListener('blur', () => paused = true);
window.addEventListener('focus', () => {
  paused = false;
  last = performance.now();
});

function update(dt) {
  if (paused) return;

  let ax = 0;
  let ay = 0;

  if (keys['ArrowLeft'] || keys['a']) ax -= 1;
  if (keys['ArrowRight'] || keys['d']) ax += 1;
  if (keys['ArrowUp'] || keys['w']) ay -= 1;
  if (keys['ArrowDown'] || keys['s']) ay += 1;

  ax += joyVec.x;
  ay += joyVec.y;

  player.vx = ax * player.speed;
  player.vy = ay * player.speed;

  player.x += player.vx * dt;
  player.y += player.vy * dt;

  score += dt * 10;
  document.getElementById('score').textContent = 'Score: ' + Math.floor(score);
}

function render() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);

  ctx.fillStyle = '#ff3b3b';
  ctx.fillRect(player.x - 10, player.y - 10, 20, 20);
}

function loop(now) {
  const dt = Math.min(0.05, (now - last) / 1000);
  last = now;
  update(dt);
  render();
  requestAnimationFrame(loop);
}

/* ==========================
   Start
========================== */
loadAssets(assetList).then(() => {
  document.getElementById('loading-screen').style.display = 'none';
  requestAnimationFrame(loop);
});
</script>

</body>
</html>
